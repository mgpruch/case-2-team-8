---
title: "Case Study 2: Olympic Team Selection"
output:
  pdf_document: default
  html_document: default
date: "2023-11-01"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(dplyr)
library(MASS)
library(purrr)
library(tidyr)
library(knitr)
```

```{r read-in, include=FALSE}
gym_data = read.csv("filtered_3.csv")
allcountries = read.csv("cleanedfinalgymnastdata.csv")
```

## Introduction

As the Paris 2024 Olympic Games draw closer, the United States gymnastics program is getting ready to continue their dominance. The US women's artistic gymnastics team is one of the most decorated nations in the sport. The program has won three team gold medals at the 1996, 2012, and 2016 Olympics seven team gold medals at the World Championships. The program also trained the most decorated female gymnast - Simone Biles - who holds 37 world and Olympic medals. Beyond just their success in the gym, the program has created an international hype around them with their Olympic gold medal teams receiving the nicknames of the Magnificent Seven, the Fierce Five, and the Final Five. At their last Olympic showing, they attracted an average of 17.4 million total viewers for their appearance in the finals. While receiving less of a media frenzy than the women's team, the US men's artistic gymnastics team are still strong competitors. Although they received no medals in Tokyo, the program has achieved 6 medals in their history and look to make a strong appearance in Paris.

In order to make a strong showing from both teams and continue the legacy of the women's program, choosing the best possible team is essential. USA Gymnastics has nearly 200,000 members from their beginning training to their elite levels, but few can be taken to the international stage to represent their country. Both teams will only be allowed to bring five members to the Paris 2024 Olympics. The women's team will compete on four apparatuses: vault, uneven bars, balance beam, and floor exercise. The men's team will compete on six apparatuses: floor exercise, pommel horse, still rings, vault, parallel bars, and high bar. Both teams will also compete in the team and individual all-around, allowing for 6 opportunities to medal for the women and 8 for the men. Out of these 5 member teams, competition will follow a 5-4-3 format (4 members out of the 5 compete on each apparatus, and the top 3 scores count). In the team all-around this changes to a 5-3-3 format, so every score counts for the 3 members chosen to compete. For the individual competitions, only 2 gymnasts max per country can qualify to move on to the finals.

With all of these considerations in terms of format and competition stages, selecting a team is very challenging. Selection takes into consideration not only scores from previous competitions, but also protecting the ability to defend a medal or title. It is more than just looking at who has the highest score, since a team has to be selected that can compete across all of these events and do their best at each apparatus. This selection is normally done by USA Gymnastics (for the women it was done by the Karolyis before the recent scandal), but we will create a more analytical way to select the team. Our analysis is centered around the goal of selecting 5-member men and women's gymnastics teams that will maximize medal counts at the Paris 2024 Olympic Games. This analysis is inspired by the UCSAS 2024 Data Challenge run by the University of Connecticut.

To achieve this goal, we are assessing data from past performances at recent competitions. Each of these competitions have scores for a gymnast's performance at a competition on one apparatus. These scores are a combination of an execution score (E Score) and a difficulty score (D Score). There also is a possible penalty that can be applied to a gymnasts score.

While previous literature on the topic of statistical analysis of Olympic team selection does not exist, there have been other attempts to apply statistical methods to the issue of team selection within the English Premier League. A 2013 paper by Jarvandi et. al used semi-Markov modeling with the issue of player selection in club soccer. Their analysis worked to predict the outcome of transfers within the League, to determine how compatible a player was with the rest of the team. This paper worked to predict the goal differential of this new addition to the team, much like we aim to predict the total score achieved by a gymnast. A much more recent paper by Nouraie et. al tackled player selection and position assignment using a deep neural network approach. This study involved much more involved data than we have access to (such GPS data to analyze player position on the field), but nonetheless motivates the importance of this work - across all sports that require assembling a team. Applying such a research task to gymnastics is a new area of study, but is important to be able to optimize the performance of the United States' 2024 gymnasts.

## Exploratory Data Analysis

```{r, include=FALSE}
#Cleaning hb issue
gym_data$Apparatus[gym_data$Apparatus == "hb"] <- "HB"
allcountries$Apparatus[allcountries$Apparatus == "hb"] <- "HB"

```

```{r Highest-Vault, include=FALSE}
#Gymnasts vault two times, which is in the data as VT1 and VT2 (or if just once VT)
#Renaming these to all just be VT, because they're all data on vaults
gym_data$Apparatus[gym_data$Apparatus == "VT1"] <- "VT"
gym_data$Apparatus[gym_data$Apparatus == "VT2"] <- "VT"
allcountries$Apparatus[allcountries$Apparatus == "VT1"] <- "VT"
allcountries$Apparatus[allcountries$Apparatus == "VT2"] <- "VT"

#Making a US Binary variable
gym_data <- gym_data %>%
  mutate(Nation = case_when(Country == "USA" ~ "USA",
                              Country != "USA" ~ "Other"))

allcountries <- allcountries %>%
  mutate(Nation = case_when(Country == "USA" ~ "USA",
                              Country != "USA" ~ "Other"))
```

We started by looking at the distribution of total scores (the combination of both the E and D scores) for all gymnasts of both genders across all apparatuses. For most of the apparatuses, the distributions had the largest number of outliers towards the lower end of the distribution and a left skew. This means that there were many gymnasts who had unusually low scores compared to the rest of the score distribution. Scores were more clustered towards the upper end of the distribution, with the average scores for all of the apparatuses being around 13 points. For both genders, the vault and floor events had the smallest range of scores.

```{r, echo = FALSE, fig.height=2.5, fig.width=4, fig.align = 'center'}
#Looking at distribution of score across different events
options(repr.plot.width = 2, repr.plot.height =2)
p <- ggplot(data = allcountries, mapping = aes(x = Apparatus, y = Score, fill = Gender)) +  
  geom_boxplot() + theme_bw() + labs(title = "Distribution of Score of Each Apparatus by Gender") +
  xlab("Apparatus") + ylab("Score") + theme(plot.title=element_text(size=9))

p + scale_fill_discrete(name = "Gender", labels = c("Men", "Women"))

#Initial issue is that some rows have a lower score hb that is making it seem like there are two categories of high bar
```
```{r MenWomen2, include=FALSE}
women_gym_data <- gym_data %>%
  filter(Gender == "w")

men_gym_data <- gym_data %>%
  filter(Gender == "m")

allcountriesw <- allcountries %>%
  filter(Gender == "w")
allcountriesm <- allcountries %>%
  filter(Gender == "m")
```

We also assessed the distribution of scores for US men and womens gymnasts against the distributions for competitors for other countries. For the women gymnasts, across all apparatuses the average score was higher for US women. This makes sense given their impressive history in the sport. The US mens distributions were on par with the distributions for gymnasts from other countries. The averages for each apparatus were mostly the same.

```{r, echo = FALSE, fig.height=2, fig.width=6, fig.align = 'center'}
library(dplyr)
ggplot(data = allcountriesw, mapping = aes(x = Apparatus, y = Score, fill = Nation)) +
  geom_violin() + theme_bw() + labs(title = "Distribution of Scores Across Appartus for US Women vs. Other Gymnasts") + xlab("Apparatus") + ylab("Score") + theme(plot.title = element_text(size=10))

ggplot(data = allcountriesm, mapping = aes(x = Apparatus, y = Score, fill = Nation)) +
  geom_violin() + theme_bw() + labs(title = "Distribution of Scores Across Appartus for US Men vs. Other Gymnasts") + xlab("Apparatus") + ylab("Score") + theme(plot.title = element_text(size=10))
```

```{r, include=FALSE}
men_gym_data <- men_gym_data %>%
  mutate(name = paste(FirstName, LastName))

men_gym_data %>% filter(Country == "USA") %>% group_by(name) %>% count()

women_gym_data <- women_gym_data %>%
  mutate(name = paste(FirstName, LastName))

women_gym_data %>% filter(Country == "USA") %>% group_by(name) %>% count()
```

```{r, include=FALSE}
us_men_gym_data <- men_gym_data %>% filter(Country == "USA")
us_womens_gym_data <- women_gym_data %>% filter(Country == "USA")
```

## Methodology

### 1. Determining Constraint Level

In order to narrow down the field from the 163 men and 59 womens American gymnasts included in our dataset, we aimed to set a constraint level that a gymnast must meet to be considered. To do this, we first filtered out any gymnast that hadn't competed in 2023. This was due to both the need for relevant data to assess what state the gymnast will be in during the 2024 competitions, but also to weed out anyone that has been injured so couldn't recently compete or who has retired after the 2022 competitions. Taking out gymnasts who hadn't competed in the past year reduced the size of our selection pool to 142 men and 47 women.

```{r, include=FALSE}
#Get rid of all gymnasts that did not compete in 2023
library(stringr)
us_womens_gym_data$Year <- str_sub(us_womens_gym_data$Date, -4)
us_men_gym_data$Year <- str_sub(us_men_gym_data$Date, -4)

length(unique(us_men_gym_data$name))
length(unique(us_womens_gym_data$name))

us_womens_gym_data <- us_womens_gym_data %>%
  group_by(name) %>%
  filter(max(Year) == 2023)

us_men_gym_data <- us_men_gym_data %>%
  group_by(name) %>%
  filter(max(Year) == 2023)

length(unique(us_men_gym_data$name))
length(unique(us_womens_gym_data$name))
```

We also filtered out gymnasts that had too low of an average score to warrant further consideration and even further reduce our selection pool. To do this, we calculated the average score across all competitions and apparatuses for each US gymnast (both male and female). We then found the first quartile value for each gender's average score. This means the average score that 25% of the average scores for male and female gymnasts respectively fell below this value. The 25th percentile score for US women gymnasts was 12.15156 and 12.15000 for men. After filtering out any competitors who had average scores below that, we were left with 106 men and 35 women.

```{r, include=FALSE}

length(unique(us_men_gym_data$name))
length(unique(us_womens_gym_data$name))
w_avs <- us_womens_gym_data %>%
  group_by(name) %>%
  summarise(mean(Score))
names(w_avs) <- c("name", "avgScore")

quantile(w_avs$avgScore)

m_avs <- us_men_gym_data %>%
  group_by(name) %>%
  summarise(mean(Score))
names(m_avs) <- c("name", "avgScore")

quantile(m_avs$avgScore)

us_womens_gym_data <- us_womens_gym_data %>%
  group_by(name) %>%
  filter(mean(Score) > 12.15156)
us_men_gym_data <- us_men_gym_data %>%
  group_by(name) %>%
  filter(mean(Score) > 12.15000)

length(unique(us_men_gym_data$name))
length(unique(us_womens_gym_data$name))
```

### 2. Heuristically Analyzing Top Performers

Next, we aimed to heuristically narrow down the teams even more by considering how the process works in real life. The top two all-around finishers are automatically named to the Olympic team, which inspired our current analysis to find two individuals that should be part of a strong lineup for both the men's and women's team. We did this by taking the previous data for each performer and creating a weight metric and adjusted score that created an "adjusted" composite score to help us determine a narrower set of individuals that have a shot of being in the final 5 team. With a narrower set of individuals, we limit our search scope for further simulations that combinatorially test sets of 5 out of this smaller set.

First, we designed a formula that would weight certain historic results more/less than others based on it: 1) being in a final round, and 2) being in a more recent performance. Final round performances contribute 1.5x the weight and we defined a linear function where outcomes carry between an additional 1 to 2.5x weighing factor depending on the month and year of the tournament (January of 2022 was set as 1x and December of 2023 was set as 2.5x).

Second, we proposed a new composite score to create a new individual scoring system based on past performances that heavily increase the positive importance of top 5 ranks and also the importance (negatively) of ranking outside the top 10. We believe that consistently scoring within the top 10 is crucial for ensuring Olympic placements as the competition is much higher and even scoring within the 10-20 range will be insufficient for improving Team USA's score. For our adjusted score, gold, silver, and bronze medals contribute 10x, 7.5x, and 5x the weight of a rank outside the top 10, while placement within the 6th-10th range contributes a 2.5 weight.

With these adjusted metrics, we produce an adjusted score for each event & apparatus that a gymnast performed in, and consider four different methods of analyzing these metrics:

1. Total sum of adjusted scores: this metric will provide us with a comprehensive way to determine a ranking of the top all-around performers, based on the sum of their weighted adjusted scores in each apparatus they perform in, that we would like to be staples on any team.

2. Best individual apparatus score: this metric will provide a ranking of the highest weighted score a competitor has in any individual apparatus.

3. Best two-apparatus score: this metric will provide a ranking of the average of the two highest scores a competitor has in their two top apparatus.

4. Best three-apparatus score: this metric will provide a ranking of the average of the three highest scores a competitor has in their three top apparatus.

We aimed to use the 2nd and 3rd metrics to determine individuals that would be very likely to excel in a few apparatuses, alongside the two best all-around performers. The 1st and 4th metrics gave a better insight into which performers were well-rounded.

To narrow down the initial set to the reduced set, we considered the top 15 performers in each of the 4 metrics, and considered the union of the 4 sets as the reduced set. We found that many of the top performers per metric overlapped for both the men and women data, and were able to reduce the search set from 97 men to 21 men, and 33 women to 17 women.

### 3. Simulating Composite Scores

The simulation of composite team scores our methodology can be broken down into two parts. To prepare the data for our simulation of composite scores, we must fit a distribution to describe the qualifying scores of each gymnast. Because each gymnast in the dataset has varying amounts of qualifying data, we believe these individual distributions will be more descriptive than a summary statistic, such as just a mean score. We anticipate that an understanding of the standard deviation of scores will help optimize the accuracy of our simulation. To assess which distribution class would best fit our score data, we first displayed the histograms for both men’s and women’s qualifier scores.

```{r, echo = FALSE, fig.height=2.5, fig.width=4, fig.align = 'center'}
#hist(us_men_gym_data$Score)
ggplot(data = us_men_gym_data, mapping = aes(x = Score)) + geom_histogram(fill = "light blue",binwidth = .5) + theme_bw() +
  labs(title = "Distribution of US Men's Gymnastics Scores") + xlab("Score") + ylab("Count") +
   theme(plot.title=element_text(size=9))

ggplot(data = us_womens_gym_data, mapping = aes(x = Score)) + geom_histogram(fill = "light blue",binwidth = .4) + theme_bw() + labs(title = "Distribution of US Women's Gymnastics Scores") + xlab("Score") + ylab("Count") + theme(plot.title=element_text(size=9))
#hist(us_womens_gym_data$Score)
```

Despite the fact that our data is bounded (scores are between 0-16), the concentration of scores in our histogram revealed symmetry around approximately the 13 score range. We therefore elected to fit the scores of each gymnast to a normal distribution, as opposed to a beta distribution or a truncated normal.

To fit these distributions, we will start by iterating through the rows of our US Mens and USA Womens data separately. For each name in the data, we will take the corresponding subset of the data containing all qualifying scores. Using these scores, we will fit a distribution to the associated gymnast, and store the mean and standard deviation, as well as the name of the gymnast into a data frame.

To eliminate redundant information in our final table, we will first use regular expressions to extract the relevant name information (i.e. Simone-BILES instead of Simone-BILES [1]), and then use the distinct function so that each gymnast has just one row in our data frame.
We will repeat this process so that we will have two separate data frames containing the names, mean scores, and standard deviation of scores for both men and women USA gymnasts. We can now use these data frames to run our composite score simulation.

```{r, include=FALSE}
set.seed(1212)

problematic_groups <- gym_data %>%
  filter(FirstName == "" | LastName == "" | FirstName == ".")%>%
  distinct()

# Filter out problematic groups from the original data
uniques <- gym_data %>%
  anti_join(problematic_groups, by = c("FirstName", "LastName"))%>%
  filter(!is.na(Score))
usa <- subset(uniques, Country == "USA")
# usa_men <- subset(usa, Gender == "m")
usa_men <- us_men_gym_data
# usa_women <- subset(usa, Gender == "w")
usa_women <- us_womens_gym_data

mu <- list()
sd <- list()
name_store <- list()
for(i in 1:nrow(usa_men)){
  first_name <- usa_men$FirstName[i]
  last_name <- usa_men$LastName[i]
  name_store[[i]] <- paste(first_name, last_name, i , sep = "-")
  sub <- usa_men %>%
    subset(LastName == last_name)%>%
    subset(FirstName == first_name)
  sub_na <- na.omit(sub$Score)
  fits <- fitdistr(sub$Score, "normal")
  mu[[i]] <- as.numeric(fits$estimate[1])
  sd[[i]] <- as.numeric(fits$estimate[2])
}

men_tib <- tibble(Names = name_store, Mu = mu, SD = sd)
men_tib$Names <- sub("^(.*?-.*?)-.*", "\\1", men_tib$Names)

men_usa <- men_tib %>%
  distinct(Names, Mu, SD)

mu_2 <- list()
sd_2 <- list()
name_store_2 <- list()
for(i in 1:nrow(usa_women)){
  first_name <- usa_women$FirstName[i]
  last_name <- usa_women$LastName[i]
  name_store_2[[i]] <- paste(first_name, last_name, i , sep = "-")
  sub <- usa_women %>%
    subset(LastName == last_name)%>%
    subset(FirstName == first_name)
  sub_na <- na.omit(sub$Score)
  fits <- fitdistr(sub$Score, "normal")
  mu_2[[i]] <- as.numeric(fits$estimate[1])
  sd_2[[i]] <- as.numeric(fits$estimate[2])
}

women_tib <- tibble(Names = name_store_2, Mu = mu_2, SD = sd_2)
women_tib$Names <- sub("^(.*?-.*?)-.*", "\\1", women_tib$Names)

women_usa <- women_tib %>%
  distinct(Names, Mu, SD)
```

The second step in our methodology is running our simulation to generate composite team scores for randomly sampled groups of five USA gymnasts. Using the output of the second step in our methodology, we can specifically sample teams from a smaller subset of male gymnasts and female gymnasts that were selected to either be the best all-around gymnasts, or gymnasts that were highly proficient in a few events. From our heuristic step, we have identified Brody Malone and Simone Biles as being the top individuals on their respective team, and have put them as a staple on each team of five. Next, we start our simulation by randomly sampling four additional different gymnast names, means, and standard deviations without replacement (men and women separately). For each gymnast sampled, we will generate one inndex based on the gymnasts’ mean and standard deviation of qualifying scores using the rnorm() function. We calculated the max score based off 10 trials where scores were penalized for high variance. We will then add this value to our variable for the composite score. When our standard deviation value was less than 1e-10, we simply assigned the mean score for that gymnast as our simulated score, as these scores often resulted in run-time errors and already had low variance. We will run this simulation process for each unique team of five gymnasts, storing the composition of gymnasts and the associated composite score. Using this data frame, we can observe the combinations in descending order to reveal which gymnasts contributed to the highest composite score.

```{r, echo=FALSE}
set.seed(500)
gymnasts <- 5
top_combos <- 10
usa_unique_final <- na.omit(men_usa)

name_list <- c(
  "Riley-LOOS",
  "Ian-LASIC",
  "Alex-DIAB",
  "Cameron-BOCK",
  "Yul-MOLDAUER",
  "Shane-WISKUS",
  "Colt-WALKER",
  "Blake-SUN",
  "Khoi-YOUNG",
  "Stephen-NEDOROSCIK",
  "Taylor-BURKHART",
  "Brandon-BRIONES",
  "Connor-MCCOOL",
  "Donnell-WHITTENBURG",
  "Asher-HONG",
  "Joshua-KARNES",
  "Paul-JUDA",
  "Frederick-RICHARD",
  "Brody-MALONE",
  "Curran-PHILLIPS",
  "Ian-SKIRKEY"
)


subset_picker <- subset(usa_unique_final, Names %in% name_list)
usa_unique_final$SD <- as.numeric(usa_unique_final$SD)
dev_max = max(usa_unique_final$SD, na.rm = TRUE)
dev_min = min(usa_unique_final$SD, na.rm = TRUE)
simulate_composite_score <- function(selected_gymnasts) {
  simulated_scores <- list()
  composite_score <- 0
  for (i in 1: nrow(selected_gymnasts)) {
    if(!is.na(selected_gymnasts$SD[i])){
      dev <- as.numeric(selected_gymnasts$SD[i])
    } else{
      dev = 1
    }
    mu <- as.numeric(selected_gymnasts$Mu[i])
    if (abs(dev) < 1e-10) {
      simulated_scores[[i]] <- mu
    } else {
#      simulated_scores[[i]] <- (0.85) * rnorm(1, mean = mu, sd = dev) +  
#        (0.15) * (1 - ((dev)^2 / dev_max - dev_min))
#        (rnorm(1, mean = mu, sd = dev) / dev)
      simulated_scores[[i]] <- max(rnorm(10, mean = mu, sd = dev) + (1 - (dev/ dev_max))^2)
    }
    composite_score <- composite_score + as.numeric(simulated_scores[[i]])
   
  }  
  return(composite_score)
}
gymnasts_without_brody <- subset_picker$Names[subset_picker$Names != "Brody-MALONE"]

# Generate all combinations of 4 other gymnasts
other_gymnast_combinations <- combn(gymnasts_without_brody, 4)

# Add "Brody-MALONE" to each combination
gymnast_combinations <- apply(other_gymnast_combinations, 2, function(column) {
  c("Brody-MALONE", column)
})

# Initialize a vector to store the composite scores for each team
composite_scores <- numeric(ncol(gymnast_combinations))

# Iterate over each combination
for(i in seq_len(ncol(gymnast_combinations))) {
  selected_gymnasts <- subset_picker[subset_picker$Names %in% gymnast_combinations[, i], ]
  composite_scores[i] <- simulate_composite_score(selected_gymnasts)
}

# Create a tibble with the results
results_tibble <- tibble(
  Gymnasts = apply(gymnast_combinations, 2, paste, collapse = ", "),
  Composite_Score = composite_scores
)

top_combinations_df <- results_tibble %>%
  mutate(Composite_Score = as.numeric(Composite_Score)) %>%
  arrange(desc(Composite_Score)) %>%
  slice_head(n = 10) %>%
  mutate(Composite_Score = round(Composite_Score, 2))

kable(top_combinations_df, digits = 2, caption = "Top 10 Male Groups of 5")
```


```{r, echo=FALSE}
set.seed(500)
gymnasts <- 5
top_combos <- 10
usa_unique_final <- na.omit(women_usa)

name_list <- c(
  "Zoe-MILLER",
  "Jordan-CHILES",
  "Leanne-WONG",
  "Simone-BILES",
  "Shilese-JONES",
  "Joscelyn-ROBERSON",
  "Skye-BLAKELY",
  "Nola-MATTHEWS",
  "Kaliya-LINCOLN",
  "Katelyn-JONG",
  "Sunisa-LEE",
  "Jade-CAREY",
  "Katelyn-ROSEN",
  "Jordis-EICHMAN",
  "Addison-FATTA",
  "Kayla-DICELLO",
  "Ashlee-SULLIVAN"
)


subset_picker <- subset(usa_unique_final, Names %in% name_list)

usa_unique_final$SD <- as.numeric(usa_unique_final$SD)
dev_max = max(usa_unique_final$SD, na.rm = TRUE)
dev_min = min(usa_unique_final$SD, na.rm = TRUE)
simulate_composite_score <- function(selected_gymnasts) {
  simulated_scores <- list()
  composite_score <- 0
  for (i in 1: nrow(selected_gymnasts)) {
    if(!is.na(selected_gymnasts$SD[i])){
      dev <- as.numeric(selected_gymnasts$SD[i])
    } else{
      dev = 1
    }
    mu <- as.numeric(selected_gymnasts$Mu[i])
    if (!is.na(dev) && abs(dev) < 1e-10) {
      simulated_scores[[i]] <- mu
    } else {
#      simulated_scores[[i]] <- (0.85) * rnorm(1, mean = mu, sd = dev) +  
#        (0.15) * (1 - ((dev)^2 / dev_max - dev_min))
#        (rnorm(1, mean = mu, sd = dev) / dev)
      simulated_scores[[i]] <- max(rnorm(10, mean = mu, sd = dev) + (1 - (dev/ dev_max))^2)
    }
    composite_score <- composite_score + as.numeric(simulated_scores[[i]])
#    cat("Iteration:", i, "mu:", mu, "dev:", dev, "Simulated Score:", simulated_scores[[i]], "Composite Score:", composite_score, "\n")
  }  
#  print(composite_score)
  return(composite_score)
}

# results <- replicate(n, {
#   sampled_gymnasts <- subset_picker[sample(nrow(subset_picker), gymnasts, replace = FALSE),]
#   composite_score <- simulate_composite_score(sampled_gymnasts)
#   results_entry <- c(Gymnasts = paste(sampled_gymnasts$Names, collapse = ", "), Composite_Score = composite_score)
#   results_entry
# })

gymnasts_without_simone <- subset_picker$Names[subset_picker$Names != "Simone-BILES"]

# Generate all combinations of 4 other gymnasts
other_gymnast_combinations <- combn(gymnasts_without_simone, 4)

gymnast_combinations <- apply(other_gymnast_combinations, 2, function(column) {
  c("Simone-BILES", column)
})

composite_scores <- numeric(ncol(gymnast_combinations))

# Iterate over each combination
for(i in seq_len(ncol(gymnast_combinations))) {
  selected_gymnasts <- subset_picker[subset_picker$Names %in% gymnast_combinations[, i], ]
  composite_scores[i] <- simulate_composite_score(selected_gymnasts)
}

# Create a tibble with the results
results_tibble <- tibble(
  Gymnasts = apply(gymnast_combinations, 2, paste, collapse = ", "),
  Composite_Score = composite_scores
)

top_combinations_df <- results_tibble %>%
  mutate(Composite_Score = as.numeric(Composite_Score)) %>%
  arrange(desc(Composite_Score)) %>%
  slice_head(n = 10) %>%
  mutate(Composite_Score = round(Composite_Score, 2))

kable(top_combinations_df, digits = 2, caption = "Top 10 Female Groups of 5")
```

### 4. Simulating Competitions in the Olympic with All Other Countries

After narrowing down the set of potential 5-member teams for men and women, we ran simulations to see how each candidate US team would perform if placed in the pool with all other teams from the world. To do this, we need to create participating teams for other countries. Here we assumed all countries had a team consisting of 5 members for men and women respectively. If the number of distinct gymnasts for a gender from a country is less than 5, we selected all the gymnasts from that country in the data set to be in the Olympic team. The men/women teams for other countries were randomly selected, so the teams may not be their "best" teams. We used random selections here because 1) it is very unlikely that all countries use identical method as the US to select the "best" team to participate in the Olympic and 2) our aim in this part is to compare the performance of narrowed-down US teams, so randomization in teams from other countries serves as a control.

We then placed each potential US team and all teams from other countries into simulated competitions. The simulated score of a gymnast in an apparatus was generated based on the mean and standard deviations of their historical scores using the rnorm() function. With each individual score, we then used the same rules as the Olympic gymnastic competitions to get the final rankings of US team in each of the 8 events for men and 6 events for women: 5-4-3 format for the qualifying round, 5-3-3 format for the team all-round, maximum of two gymnasts per country for the individual all-round, and maximum of 2 gymnasts per country for each apparatus final, except that we integrated the 5-4-3 and 5-3-3 format together, removing the need of taking the precedence of the qualifying rounds over finals into consideration.

For each simulated competition result, we used a weighted metrics to calculate a "total medal score" for the US team - a score of 3 for gold, 2 for silver, and 1 for bronze. We then computed the mean of this total medal score from all iterations of simulation for each potential US team and compared their scores.

```{r MenWomen, include=FALSE}
allcountries <- allcountries %>%
  mutate(name = paste(FirstName, LastName))

women_gym_data <- allcountries %>%
  filter(Gender == "w")

men_gym_data <- allcountries %>%
  filter(Gender == "m")

```

```{r include=FALSE}
# function that simulates a random score for a gymnast in an apparatus
simulate_score_men <- function(gymnast, apparatus) {
  data = men_gym_data %>% filter(name == gymnast, Apparatus == apparatus)
  if (nrow(data) == 0) { # if the gymnast has no historical data in this apparatus then return a score of 0
    return(0)
  }
  # else return simulated score
  data <- data%>%
    group_by(name) %>%
    summarise(mean = mean(Score, na.rm = T),
              var = var(Score, na.rm = T))
  mu <- data$mean
  var <- data$var
  score <- rnorm(1, mu, var)
  return(score)
}
simulate_score_women <- function(gymnast, apparatus) {
  data = women_gym_data %>% filter(name == gymnast, Apparatus == apparatus)
  if (nrow(data) == 0) { # if the gymnast has no historical data in this apparatus then return a score of 0
    return(0)
  }
  # else return simulated score
  data <- data%>%
    group_by(name) %>%
    summarise(mean = mean(Score, na.rm = T),
              var = var(Score, na.rm = T))
  mu <- data$mean
  var <- data$var
  score <- rnorm(1, mu, var)
  return(score)
}
```


```{r selected us team, include=FALSE}
# replace the righthand part with each us team selected from part 2 (here I use a random sample)
men_name_list <- c("Curran-PHILLIPS", "Taylor-BURKHART", "Blake-SUN", "Brody-MALONE", "Stephen-NEDOROSCIK")
subset_picker_m <- subset(us_men_gym_data, name %in% men_name_list)

women_name_list <- c("Simone-BILES", "Jade-CAREY", "Joscelyn-ROBERSON", "Kayla-DICELLO", "Zoe-MILLER")
subset_picker_f <- subset(us_womens_gym_data, name %in% women_name_list)

us_team_men <- sample(unique(us_men_gym_data$name), 5)
us_team_women <- sample(unique(us_womens_gym_data$name), 5)
```

```{r total medal score, warning=FALSE, message=FALSE, include=FALSE}
# score 3 for gold, 2 for silver, 1 for bronze
apparatus_men <- unique(men_gym_data$Apparatus)
apparatus_women <- unique(women_gym_data$Apparatus)
country_list <- unique(men_gym_data$Country)
country_list <- country_list[country_list != 'USA']
num_iterations = 1
men_total_medal_score = list() # store possible total medal scores for 1000 iterations
for (iter in 1:num_iterations) {
  total_medal = 0

  men_other_countries <- data.frame()
  for (i in 1:length(country_list)) {
    data <- men_gym_data %>%
      filter(Country == country_list[i])
    gymnasts <- unique(data$name)
    if (length(gymnasts) > 0) {
      data = data.frame(country = country_list[i], gymnast = sample(gymnasts, min(5, length(gymnasts)))) # at most 5 gymnasts for each country
      men_other_countries <- bind_rows(men_other_countries, data)
    }
  }

  # men
  for (apparatus in apparatus_men) { # for each apparatus
    apparatus_medal = 0
    results <- data.frame() # competition results
    for (c in unique(men_other_countries$country)) { # each country can have 2 men competing in each final apparatus
      # other countries
      data = men_other_countries %>% filter(country == c)
      scores <- list()
      for (gymnast in data$gymnast) {
        score <- simulate_score_men(gymnast, apparatus)
        if (!is.na(score)) {
          scores = append(scores, score)
        }
      }
      scores <- scores[!is.na(scores)] # drop NA scores
      # assume gymnasts with highest simulated score are the 2 selected for individual finals
      if (length(scores) > 2) {
        scores <- lapply(scores, sort, decreasing=TRUE)
        scores <- scores[1:2]
      }
      scores = unlist(scores)
      if (length(scores) != 0) { # if there is at least 1 non-NA scores
        data = data.frame(country = c, score = scores)
        results = bind_rows(results, data)
      }
    }
    # us team
    us_scores <- list()
    for (gymnast in us_team_men) { # selected team members from part2
      score <- simulate_score_men(gymnast, apparatus)
      if (!is.na(score)) {
        us_scores = append(us_scores, score)
      }
    }
    us_scores <- us_scores[!is.na(us_scores)]
    if (length(us_scores) > 2) {
      us_scores <- lapply(us_scores, sort, decreasing=TRUE)
      us_scores <- us_scores[1:2]
    }
    us_scores = unlist(us_scores)
    if (length(us_scores) != 0) { # if there is at least 1 non-NA scores
      data = data.frame(country = 'USA', score = us_scores)
      results = bind_rows(results, data)
    }
    # sort scores for all countries
    results = results %>%
      arrange(desc(score))
    # medals
    if (results[1,]$country == 'USA') {
      apparatus_medal = apparatus_medal + 3 # 3 for gold
    }
    else if (results[2,]$country == 'USA') {
      apparatus_medal = apparatus_medal + 2 # 2 for silver
    }
    else if (results[3,]$country == 'USA') {
      apparatus_medal = apparatus_medal + 1 # 1 for bronze
    }
  }
  total_medal = total_medal + apparatus_medal

  # men team all-round
  results_team <- data.frame() # competition results for all apparatus
  for (apparatus in apparatus_men) { # for each apparatus
     # competition results
    for (country in unique(men_other_countries$country)) { # each country
      # other countries
      data = men_other_countries %>% filter(country == country)
      scores <- list()

      gymnasts <- data$gymnast
      if (length(gymnasts) > 4) {
        gymnasts <- sample(gymnasts, 4) # each country can select 3 gymnasts
      }
      for (gymnast in gymnasts) {
        score <- simulate_score_men(gymnast, apparatus)
        scores = append(scores, score)
      }
      if (length(scores) > 3) {
        scores <- lapply(scores, sort, decreasing=TRUE)
        scores <- scores[1:3] # 3 top scores out of 4 gymnasts
      }
      scores = unlist(scores)
      if (length(scores) != 0) {
        data = data.frame(country = country, score = sum(scores))
        results_team = bind_rows(results_team, data)
      }

    }
    # us team
    us_scores <- list()
    for (gymnast in us_team_men) { # selected team members from part2
      score <- simulate_score_men(gymnast, apparatus)
      us_scores = append(us_scores, score)
    }
    gymnasts <- sample(gymnasts, 4) # each country can select 4 gymnasts
    for (gymnast in gymnasts) {
      score <- simulate_score_men(gymnast, apparatus)
      us_scores = append(us_scores, score)
    }
    us_scores <- lapply(us_scores, sort, decreasing=TRUE)
    us_scores <- unlist(us_scores[1:3]) # 3 top scores out of 4 gymnasts
    if (length(us_scores) != 0) {
      data = data.frame(country = 'USA', score = sum(us_scores))
      results_team = bind_rows(results_team, data)
    }

  }

  results_team = results_team %>%
    group_by(country) %>%
    summarise(team_score = sum(score)) %>% # add up score for each apparatus
    arrange(desc(team_score))
  # medals
  if (results_team[1,]$country == 'USA') {
    total_medal = total_medal + 3 # 3 for gold
  }
  if (results_team[2,]$country == 'USA') {
    total_medal = total_medal + 2 # 2 for silver
  }
  if (results_team[3,]$country == 'USA') {
    total_medal = total_medal + 1 # 1 for bronze
  }

  # individual all-round
  results_indi <- data.frame() # competition results for all apparatus
  # men
  for (apparatus in apparatus_men) { # for each apparatus
     # competition results
    for (country in unique(men_other_countries$country)) { # each country
      # other countries
      data = men_other_countries %>% filter(country == country)

      gymnasts <- data$gymnast
      if (length(gymnasts) > 2) {
        gymnasts <- sample(gymnasts, 2) # each country randomly select 2 gymnasts for individual all-round
      }
      for (gymnast in gymnasts) {
        score <- simulate_score_men(gymnast, apparatus)
        if (!is.na(score)) {
          data = data.frame(country = country, gymnast = gymnast, score = score)
          results_indi = bind_rows(results_indi, data)
        }
      }
    }
    # us
    gymnasts <- sample(us_team_men, 2) # randomly select 2 gymnasts from team selected in part2
    for (gymnast in gymnasts) {
      score <- simulate_score_men(gymnast, apparatus)
      data = data.frame(country = 'USA', gymnast = gymnast, score = us_scores)
      results_indi = bind_rows(results_indi, data)
    }

  }

  results_indi = results_indi %>%
    group_by(country, gymnast) %>%
    summarise(all_round_score = sum(score)) %>% # add up score for each apparatus
    arrange(desc(all_round_score))
  # medals
  if (results_indi[1,]$country == 'USA') {
    total_medal = total_medal + 3 # 3 for gold
  }
  if (results_indi[2,]$country == 'USA') {
    total_medal = total_medal + 2 # 2 for silver
  }
  if (results_indi[3,]$country == 'USA') {
    total_medal = total_medal + 1 # 1 for bronze
  }
}
```

```{r total medal score2, warning=FALSE, message=FALSE, include=FALSE}
# score 3 for gold, 2 for silver, 1 for bronze
apparatus_men <- unique(men_gym_data$Apparatus)
apparatus_women <- unique(women_gym_data$Apparatus)
country_list <- unique(men_gym_data$Country)
country_list <- country_list[country_list != 'USA']
num_iterations = 1
total_medal_score = list() # store possible total medal scores for 1000 iterations
for (iter in 1:num_iterations) {
  total_medal = 0

  # select gymnast team for other countries (assuming the gymnasts from other countries are randomly selected because it's impossible that all countries use identical method as US to select gymnasts to participate in the Olympics

  women_other_countries <- data.frame()
  for (i in 1:length(country_list)) {
    data <- women_gym_data %>%
      filter(Country == country_list[i])
    gymnasts <- unique(data$name)
    if (length(gymnasts) > 0) {
      data = data.frame(country = country_list[i], gymnast = sample(gymnasts, min(5, length(gymnasts)))) # 5 gymnasts for each country
      women_other_countries <- bind_rows(women_other_countries, data)
    }
  }

  # women
  for (apparatus in apparatus_women) { # for each apparatus
    apparatus_medal = 0
    results <- data.frame() # competition results for each apparatus
    for (c in unique(women_other_countries$country)) { # each country can have 2 women competing in each final apparatus
      # other countries
      data = women_other_countries %>% filter(country == c)
      scores <- list()
      for (gymnast in data$gymnast) {
        score <- simulate_score_men(gymnast, apparatus)
        scores = append(scores, score)
      }
      if (length(scores) > 2) {
        scores <- lapply(scores, sort, decreasing=TRUE)
        scores <- scores[1:2]
      }
      scores <- unlist(scores)
      if (length(scores != 0)) {
        data = data.frame(country = c, score = scores)
        results = bind_rows(results, data)
      }
    }
    # us team
    us_scores <- list()
    for (gymnast in us_team_women) { # selected team members from part2
      score <- simulate_score_women(gymnast, apparatus)
      if (!is.na(score)) {
        us_scores = append(us_scores, score)
      }
    }
    if (length(us_scores) > 2) {
      us_scores <- lapply(us_scores, sort, decreasing=TRUE)
      us_scores <- us_scores[1:2]
    }
    us_scores <- unlist(us_scores)
    data = data.frame(country = 'USA', score = us_scores)
    results = bind_rows(results, data)

    # sort scores for all countries
    results = results %>%
      arrange(desc(score))
    # medals
    if (results[1,]$country == 'USA') {
      apparatus_medal = apparatus_medal + 3 # 3 for gold
    }
    if (results[2,]$country == 'USA') {
      apparatus_medal = apparatus_medal + 2 # 2 for silver
    }
    if (results[3,]$country == 'USA') {
      apparatus_medal = apparatus_medal + 1 # 1 for bronze
    }
  }
  total_medal = total_medal + apparatus_medal

  # women team all-round
  results_team <- data.frame() # competition results for all apparatus
  for (apparatus in apparatus_women) { # for each apparatus
     # competition results
    for (country in unique(women_other_countries$country)) { # each country
      # other countries
      data = women_other_countries %>% filter(country == country)
      scores <- list()

      gymnasts <- data$gymnast
      if (length(gymnasts) > 4) {
        gymnasts <- sample(gymnasts, 4) # each country can select 4 gymnasts
      }
      for (gymnast in gymnasts) {
        score <- simulate_score_women(gymnast, apparatus)
        scores = append(scores, score)
      }
      if (length(scores) > 3) {
        scores <- lapply(scores, sort, decreasing=TRUE)
        scores <- scores[1:3] # 3 top scores out of 4 gymnasts
      }
      scores = unlist(scores)
      if (length(scores) != 0) {
        data = data.frame(country = country, score = sum(scores))
        results_team = bind_rows(results_team, data)
      }

    }
    # us team
    us_scores <- list()
    for (gymnast in us_team_women) { # selected team members from part2
      score <- simulate_score_women(gymnast, apparatus)
      us_scores = append(us_scores, score)
    }
    gymnasts <- sample(gymnasts, 4) # each country can select 4 gymnasts
    for (gymnast in gymnasts) {
      score <- simulate_score_women(gymnast, apparatus)
      us_scores = append(us_scores, score)
    }
    us_scores <- lapply(us_scores, sort, decreasing=TRUE)
    us_scores <- unlist(us_scores[1:3]) # 3 top scores out of 4 gymnasts
    if (length(us_scores) != 0) {
      data = data.frame(country = 'USA', score = sum(us_scores))
      results_team = bind_rows(results_team, data)
    }

  }

  results_team = results_team %>%
    group_by(country) %>%
    summarise(team_score = sum(score)) %>% # add up score for each apparatus
    arrange(desc(team_score))
    # medals
  if (results_team[1,]$country == 'USA') {
    total_medal = total_medal + 3 # 3 for gold
  }
  if (results_team[2,]$country == 'USA') {
    total_medal = total_medal + 2 # 2 for silver
  }
  if (results_team[3,]$country == 'USA') {
    total_medal = total_medal + 1 # 1 for bronze
  }

  # individual all-round
  results_indi <- data.frame() # competition results for all apparatus
  for (apparatus in apparatus_women) { # for each apparatus
     # competition results
    for (country in unique(women_other_countries$country)) { # each country
      # other countries
      data = women_other_countries %>% filter(country == country)

      gymnasts <- data$gymnast
      if (length(gymnasts) > 2) {
        gymnasts <- sample(gymnasts, 2) # each country randomly select 2 gymnasts for individual all-round
      }
      for (gymnast in gymnasts) {
        score <- simulate_score_women(gymnast, apparatus)
        if (!is.na(score)) {
          data = data.frame(country = country, gymnast = gymnast, score = score)
          results_indi = bind_rows(results_indi, data)
        }
      }
    }
    # us
    gymnasts <- sample(us_team_women, 2) # randomly select 2 gymnasts from team selected in part2
    for (gymnast in gymnasts) {
      score <- simulate_score_men(gymnast, apparatus)
      data = data.frame(country = 'USA', gymnast = gymnast, score = us_scores)
      results_indi = bind_rows(results_indi, data)
    }

  }

  results_indi = results_indi %>%
    group_by(country, gymnast) %>%
    summarise(all_round_score = sum(score)) %>% # add up score for each apparatus
    arrange(desc(all_round_score))
  # medals
  if (results_indi[1,]$country == 'USA') {
    total_medal = total_medal + 3 # 3 for gold
  }
  if (results_indi[2,]$country == 'USA') {
    total_medal = total_medal + 2 # 2 for silver
  }
  if (results_indi[3,]$country == 'USA') {
    total_medal = total_medal + 1 # 1 for bronze
  }

}
```

```{r compare selected us teams, include=FALSE}
# mean total medal score for the 100 simulations for one us team
# mean(total_medal_score)
```

## Results

### Subsetting

After our initial filtering removed participants that were well outside of a top 5 range, we used our heuristics described in the methodology to further subset mens participants and womens participants using a new weighted composite score. We used 4 different metrics to analyze this data: the sum of composite scores across each apparatus, the maximum individual apparatus score, and the average top 2 and top 3 apparatus score for each individual.

Starting with men's results, we were able to pinpoint Brody Malone as being the clear top overall performer in the men's division, without an obvious number 2 all-around performer (and opted to use our simulations to fill in the rest of the team).

Below, we show how each of the members on the men's team selected to be included in the simulation perform across all four metrics.

```{r, echo = FALSE}
data_list <- list(
  c('Riley LOOS', c(10, 16, 10, 11)),
  c('Ian LASIC-ELLIS', c(14, 20, 18, 16)),
  c('Alex DIAB', c(56, 12, 17, 19)),
  c('Cameron BOCK', c(12, 24, 16, 15)),
  c('Yul MOLDAUER', c(15, 19, 12, 13)),
  c('Shane WISKUS', c(11, 21, 15, 12)),
  c('Colt WALKER', c(8, 8, 9, 9)),
  c('Blake SUN', c(55, 14, 14, 18)),
  c('Khoi YOUNG', c(7, 7, 4, 4)),
  c('Stephen NEDOROSCIK', c(64, 4, 89, 80)),
  c('Taylor BURKHART', c(5, 6, 5, 7)),
  c('Brandon BRIONES', c(32, 10, 13, 14)),
  c('Connor MCCOOL', c(75, 13, 21, 80)),
  c('Donnell WHITTENBURG', c(2, 3, 3, 3)),
  c('Asher HONG', c(4, 11, 7, 8)),
  c('Joshua Andrew KARNES', c(9, 15, 11, 10)),
  c('Paul JUDA', c(6, 17, 8, 6)),
  c('Frederick Nathaniel RICHARD', c(3, 5, 6, 5)),
  c('Brody MALONE', c(1, 1, 1, 1)),
  c('Curran PHILLIPS', c(13, 2, 2, 2)),
  c('Ian SKIRKEY', c(79, 9, 89, 80))
)


# Sort by last name
# Convert to data frame
data_df <- do.call(rbind, lapply(data_list, function(x) {
  c(Name = x[1], `Sum Score Rank` = x[2], `Best 1 App Rank` = x[3], `Best 2 App Rank` = x[4], `Best 3 App Rank` = x[5])
}))
data_df <- as.data.frame(data_df, stringsAsFactors = FALSE)

# Use kable to create the table
kable(data_df, caption = "Four Metric Ranks for Male Gymnasts")  # Change 'html' to 'latex' or 'markdown' if needed
```

Brody Malone was clearly the best all around performer for the men's team, so we would recommend that he be considered a lock for the final team of 5. Donnell Whittenburg also performed exceedingly well across all four metrics. There were certain athletes such as Curran Phillips, Stephen Nedoroscik, and Ian Skirkey who seemed to be mainly good at one or two of the apparatuses, but not a great all-around performer - we would be interested in these athletes to fill out our team of 5 in the hopes that they can perform very well in a specialized event. Cutting to fewer, more qualified athletes will assist in ensuring that our simulation is able to fully search for the best pairing of 5.

Next, moving onto the women's results.

Below, we provide a table showing how each of the members on the women's team selected to be included in the simulation perform across all four metrics.
```{r, echo = FALSE}

data_list <- list(
  c('Zoe MILLER', c(7, 1, 5, 5)),
  c('Jordan CHILES', c(2, 5, 2, 3)),
  c('Leanne WONG', c(14, 19, 17, 15)),
  c('Simone BILES', c(1, 4, 1, 1)),
  c('Shilese JONES', c(6, 8, 8, 8)),
  c('Joscelyn ROBERSON', c(3, 6, 3, 2)),
  c('Skye BLAKELY', c(9, 10, 10, 9)),
  c('Nola MATTHEWS', c(13, 16, 13, 13)),
  c('Kaliya LINCOLN', c(8, 2, 6, 6)),
  c('Katelyn JONG', c(12, 14, 11, 12)),
  c('Sunisa LEE', c(30, 11, 14, 32)),
  c('Jade CAREY', c(4, 3, 4, 4)),
  c('Katelyn ROSEN', c(15, 13, 15, 14)),
  c('Jordis EICHMAN', c(16, 12, 16, 16)),
  c('Addison FATTA', c(11, 15, 12, 11)),
  c('Kayla DICELLO', c(5, 7, 7, 7)),
  c('Ashlee SULLIVAN', c(10, 9, 9, 10))
)


# Sort by last name
# Convert to data frame
data_df <- do.call(rbind, lapply(data_list, function(x) {
  c(Name = x[1], `Sum Score Rank` = x[2], `Best 1 App Rank` = x[3], `Best 2 App Rank` = x[4], `Best 3 App Rank` = x[5])
}))
data_df <- as.data.frame(data_df, stringsAsFactors = FALSE)

# Use kable to create the table
kable(data_df, caption = "Four Metric Ranks for Female Gymnasts")  # Change 'html' to 'latex' or 'markdown' if needed
```

From the above table, we were able to pinpoint Simone Biles as the clear top performer as an all-around athlete, but following was Jordan Chiles with a high composite score that also warrants a spot as an all-around athlete. Zoe Miller and Kaliya Lincoln present more interesting scenarios where they performs highly in few events, which could be valuable if they are projected to medal gold or silver in that single event. On the other hand, outside of Biles and Chiles, Jade Carey, Joscelyn Roberson, and Kayla Dicello perform consistently high - but not highest - on a larger range of events.

### Simulating Composite Scores

Combining our analysis in parts two and three, we were able to calculate the combination of men's and women's USA teams that elicited the highest composite statistics in our simulation. After setting a seed and running a simulation on the men’s data for each possible combination of 4 athletes post-filtering (Brody Malone was considered a staple on any team), our results yielded that the highest composite scoring men's team includes Brody Malone, Stephen Nedoroscik, Curran Phillips, Ian Skirkey, and Colt Walker. This team combination generated a composite score of approximately 81.31. In other words, the average score for each member of this team is 16.262. This mean score is much higher than the individual means of the gymnasts. It is possible that the number of samples in our simulation still slightly favors gymnasts with higher variances, distorting top scores to be slightly higher than expected. We expected that penalizing for higher variance values using $(1 - \frac{dev}{dev_\text{max}})^2$ would be more impactful. This holds true for the next closest team (as well as in our women’s data set), consisting of Brody Malone, Yul Moldauer, Curran Phillips, Ian Skirkey, and Shane Wiskus, with a score of 81.30. Curran Phillips seemed to be a staple for many of the top teams, as well as Ian Skirkey.

Our USA women’s output from our simulation - which included Simone Biles as the staple on every team - yielded that the highest composite scoring team has a roster of Simone Biles, Jade Carey, Kayla Dicello, Zoe Miller, and Joscelyn Roberson. The composite score for this roster was 78.88. Under this total score assumption, each gymnast would score a 15.776 on average. The second closest team features two of the same gymnasts in its overall lineup of Simone Biles, Jade Carey, Jordan Chiles, Kaliya Lincoln, and Leanne Wong, with a total score of approximately 78.61. We did see Jade Carey and Zoe Miller on a large portion of the top performing teams, suggesting that our model has high confidence that they should be on the final team. The overlap between gymnasts in top-composite-scoring teams for both men and women is a source of confidence in our model.

While average scores are ultimately high, and our number of simulations may occasionally favor gymnasts with high variances, our outputs give us a reasonable estimate of a starting combination for both the men’s and women’s 2024 Olympics lineup.

### Simulating Medals

Our preliminary simulation for medaling provides us a way to simulate how our team would perform against other countries. Using the methodology proposed to create an international team to test the US team against, we are able to see how our 2 lineups would score against other teams.

Using a scoring system of 3 points for Gold, 2 points for Silver, and 1 point for Bronze, our men's team most frequently earned 9 points, with little variance (a minimum of 6 points and a maxiumum of 13 points). Our women's team performed stronger and averaged closer to 14 points in the simulation with higher variance (from 11 points to 22 points).

### Discussion

In our analysis we aimed to address the goal of determining both a mens and womens artistic gymnastics team for the United States of America to send to the Paris 2024 Olympics. We wanted this team to be the optimal selection, maximizing the medal count at the games. We were able to achieve this through our four-step methodology. First, we set a constraint criteria that limited our selection pool. We then heuristically analyzed our top performs mirroring the selection process used for past games. After that, we simulated composite scores for our US Olympics teams and finally compared those against simulated scores for other nations' Olympic teams.

There were a few limitations with the data. One was that the dataset itself did not include information on defending champions - something that is common for Olympic selection committees to weigh highly in their decision making. Although we were able to take this into account by making sure to include defending champions such as Simone Biles (and the men's team had no defending champions to address), it would be an interesting addition to our work to have data on this. Another limitation is that this data just included scores in competition. There was no additional information about the athletes’ performances, such as if they are currently healthy or injured or even if they plan to or want to compete in the Paris 2024 Olympics. While we mitigated this by selecting only gymnasts with recent performances, this additional information would have improved our analysis.

We were able to address our ultimate goal by forming two teams that stand a strong chance in Paris. The men’s team that we selected consisted of Brody Malone, Yul Moldauer, Curran Phillips, Ian Skirkey, and Shane Wiskus. Our results showed that this team had an average score of 16.262 per member and a composite score of 81.31. These scores were much higher than average, and after simulating scores for other nations show that this team has the strongest chance of bringing home the most medals.

Our womens’ team selection further addressed our ultimate goal of Paris 2024 dominance. Our team of Simone Biles, Jade Carey, Kayla Dicello, Zoe Miller, and Joscelyn Roberson features two defending medalists. Their simulated average score of 15.776 per member gives them a competitive advantage which is supported by their composite score of 78.88.

Our analysis has produced teams with the highest simulated average and composite scores. Compared against simulated scores for teams from other nations, our selected US teams stand to perform better than scores from those teams. Our selection process has created the strongest chances for Team USA in the 2024 Olympics, and provides an exciting new way that statistical analysis can be applied to this previously subjective process of team selection.


## Sources
Artistic Gymnastics. Paris 2024. (2023, June 1). https://www.paris2024.org/en/sport/artistic-gymnastics/

Jarvandi, Ali, Sarkani, Shahram and Mazzuchi, Thomas. "Modeling team compatibility factors using a semi-Markov decision process: a data-driven approach to player selection in soccer" Journal of Quantitative Analysis in Sports, vol. 9, no. 4, 2013, pp. 347-366. https://doi.org/10.1515/jqas-2012-0054

Nouraie, M., Eslahchi, C. & Baca, A. Intelligent team formation and player selection: a data-driven approach for football coaches. Appl Intell (2023). https://doi.org/10.1007/s10489-023-05150-x

Wikimedia Foundation. (2023a, October 8). United States men’s National Artistic Gymnastics Team. Wikipedia. https://en.wikipedia.org/wiki/United_States_men%27s_national_artistic_gymnastics_team

Wikimedia Foundation. (2023, November 13). United States women’s National Artistic Gymnastics Team. Wikipedia. https://en.wikipedia.org/wiki/United_States_women%27s_national_artistic_gymnastics_team
